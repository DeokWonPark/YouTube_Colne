## 구현하며 ....

비동기 함수 와 랜더링의 구현순서에 어려움

**함수를 반복을 돌면서 그때그때 실행하는것이 아닌 PromiseAll을 통해 병렬적으로 처리** 함으로써 해결

(before)

LoadVideoItems=()=>{

  const requestOptions = {

   method: 'GET',

   redirect: 'follow'

  };

  

  fetch("https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=2&regionCode=kr&key=AIzaSyAbct7nLtHNu1yGc0q6BNj9l3NuL1YxjUs", requestOptions)

   .then(response => response.json())

   .then(async (result) => {

​    const videos=[];

​    await result.items.map(async (item)=>{

​     item = await this.LoadChannelItems(item.snippet.channelId,item);

​     console.log(item.snippet.channels);

​     videos.push(item);

​    });



​    return new Promise((resolve,reject)=>{

​     resolve(videos);

​    })

   })

   .then((videos)=>this.setState({videos}))

   .catch(error => console.log('error', error));

 };





 LoadChannelItems=async (channelId,item)=>{

  var requestOptions = {

   method: 'GET',

   redirect: 'follow'

  };

  

  await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=AIzaSyAbct7nLtHNu1yGc0q6BNj9l3NuL1YxjUs`, requestOptions)

   .then((response) => response.json())

   .then((result) => {

​    item.snippet.channels=result.items[0].snippet.thumbnails.medium.url;

   })

   .catch(error => console.log('error', error));



   return new Promise((resolve,reject)=>{

​    resolve(item);

   })

 }



--------------------------------------------------------------------------------

(after)

LoadVideoItems=()=>{
    const requestOptions = {
      method: 'GET',
      redirect: 'follow'
    };
    
    fetch("https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=2&regionCode=kr&key=AIzaSyAbct7nLtHNu1yGc0q6BNj9l3NuL1YxjUs", requestOptions)
      .then(response => response.json())
      .then((result) => {
        const videos=[];
        const promises=[];
        result.items.map((item)=>{
          promises.push(this.LoadChannelItems(item.snippet.channelId,item)); //수행할 비동기 함수들을 삽입
        });
    
        Promise.all(promises).then((values)=>console.log(values[0].snippet.channels)); //병렬적으로 비동기 함수 실행
      })
      .then((videos)=>this.setState({videos}))
      .catch(error => console.log('error', error));
  };

  LoadChannelItems=async (channelId,item)=>{
    var requestOptions = {
      method: 'GET',
      redirect: 'follow'
    };
    
     await fetch(`https://www.googleapis.com/youtube/v3/channels?part=snippet&id=${channelId}&key=AIzaSyAbct7nLtHNu1yGc0q6BNj9l3NuL1YxjUs`, requestOptions)
      .then((response) => response.json())
      .then((result) => {
        item.snippet.channels=result.items[0].snippet.thumbnails.medium.url;
      })
      .catch(error => console.log('error', error));
    
      return new Promise((resolve,reject)=>{
        resolve(item);
      })
  }